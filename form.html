<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>İletişim ve Genel Form</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;0,700;1,400;1,500&family=Montserrat:wght@300;400;500;600&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <style>
      /* Contact page spacing tweaks to keep layout compact only on this page */
      .contact-page .breadcrumb { padding: 6px 0; margin-bottom: 8px; }
      .contact-page .page { padding-top: 0; margin-top: 0; }
      .contact-page .form-section .form-intro { margin: 16px auto 16px; }
      .contact-page .form-section .form-grid { margin-top: 20px; }
      /* When aside is removed, ensure clean stacking */
      .contact-page .form-grid { display: block; }
      @media (max-width: 768px) {
        .contact-page .form-section .form-intro { margin: 12px auto 14px; }
      }

      /* Visual hierarchy & accent for contact page */
      .contact-page .detail-title {
        font-family: 'Cormorant Garamond', serif;
        font-weight: 600;
        letter-spacing: .01em;
      }
      .contact-page .detail-desc {
        font-size: 0.98rem;
        color: rgba(0,0,0,0.6);
        line-height: 1.7;
        max-width: 820px;
      }
      .contact-page .form-card,
      .contact-page .aside-card {
        border-radius: 14px;
      }
      .contact-page .form-card {
        background: #ffffff;
        border: 1px solid rgba(0,0,0,0.06);
        box-shadow:
          0 18px 40px rgba(11, 28, 62, 0.10),
          0 12px 32px rgba(184, 58, 58, 0.18),
          0 2px 0 rgba(255,255,255,0.65) inset,
          0 0 0 1px rgba(184,58,58,0.08) inset;
        transition: box-shadow .25s ease, transform .2s ease;
      }
      .contact-page .form-card:hover {
        box-shadow:
          0 22px 50px rgba(11, 28, 62, 0.14),
          0 16px 40px rgba(184, 58, 58, 0.26),
          0 2px 0 rgba(255,255,255,0.7) inset,
          0 0 0 1px rgba(184,58,58,0.10) inset;
        transform: translateY(-2px);
      }
      .contact-page input,
      .contact-page select,
      .contact-page textarea {
        transition: box-shadow .2s ease, border-color .2s ease, background-color .2s ease;
        border-radius: 10px;
      }
      /* Form labels: match input placeholder style (clean sans) */
      .contact-page .form-field label {
        font-family: 'Montserrat', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
        font-weight: 700;
        letter-spacing: .02em;
        text-transform: none;
        font-size: 0.95rem;
        color: #b83a3a;
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }
      /* Hide native select but keep in DOM */
      .contact-page .hidden-select {
        position: absolute !important;
        opacity: 0 !important;
        width: 1px !important;
        height: 1px !important;
        pointer-events: none !important;
      }
      /* Custom dropdown */
      .contact-page .custom-select { position: relative; }
      .contact-page .custom-select-toggle {
        width: 100%;
        height: 46px;
        line-height: 46px;
        padding: 0 46px 0 14px;
        border: 1px solid rgba(0,0,0,0.12);
        background: #fff;
        border-radius: 10px;
        text-align: left;
        color: rgba(0,0,0,0.85);
        cursor: pointer;
        font: inherit;
        transition: border-color .2s ease, box-shadow .2s ease, background-color .2s ease;
      }
      .contact-page .custom-select-toggle:hover { border-color: rgba(0,0,0,0.22); }
      .contact-page .custom-select-toggle:focus { outline: none; border-color: #b83a3a; box-shadow: 0 0 0 3px rgba(184,58,58,0.12); }
      .contact-page .custom-select-toggle::after {
        content: '';
        position: absolute;
        right: 14px;
        top: 50%;
        width: 16px; height: 16px;
        transform: translateY(-50%);
        background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 20 20'%3E%3Cpath fill='rgba(0,0,0,0.55)' d='M5.8 7.5a1 1 0 0 1 1.4 0L10 10.3l2.8-2.8a1 1 0 1 1 1.4 1.4l-3.5 3.5a1 1 0 0 1-1.4 0L5.8 8.9a1 1 0 0 1 0-1.4Z'/%3E%3C/svg%3E") center/16px 16px no-repeat;
        pointer-events: none;
        opacity: .7;
      }
      .contact-page .custom-select-menu {
        position: absolute;
        left: 0; right: 0; top: calc(100% + 6px);
        background: #fff;
        border: 1px solid rgba(0,0,0,0.12);
        border-radius: 12px;
        box-shadow: 0 14px 40px rgba(0,0,0,0.16);
        padding: 6px;
        max-height: 260px;
        overflow: auto;
        z-index: 20;
        display: none;
      }
      /* bordo üst şerit ve etiket */
      .contact-page .custom-select.open .custom-select-menu { display: block; }
      .contact-page .custom-select-menu::before {
        content: '';
        display: block;
        height: 3px;
        background: #b83a3a;
        border-top-left-radius: 12px;
        border-top-right-radius: 12px;
        margin: -6px -6px 6px -6px;
      }
      .contact-page .custom-select-label {
        font-size: 0.78rem;
        letter-spacing: .04em;
        text-transform: uppercase;
        color: rgba(0,0,0,0.55);
        padding: 4px 8px 6px;
      }
      .contact-page .custom-select-option {
        padding: 10px 12px;
        border-radius: 10px;
        color: rgba(0,0,0,0.85);
        cursor: pointer;
        transition: background-color .15s ease, color .15s ease;
      }
      .contact-page .custom-select-option:hover { background: rgba(184,58,58,0.06); }
      .contact-page .custom-select-option[aria-selected="true"] { background: rgba(184,58,58,0.10); color: #8f2c2c; }
      /* Sleek dropdown */
      .contact-page select {
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        background-color: #fff;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 20 20'%3E%3Cpath fill='rgba(0,0,0,0.55)' d='M5.8 7.5a1 1 0 0 1 1.4 0L10 10.3l2.8-2.8a1 1 0 1 1 1.4 1.4l-3.5 3.5a1 1 0 0 1-1.4 0L5.8 8.9a1 1 0 0 1 0-1.4Z'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 14px center;
        background-size: 16px 16px;
        padding-right: 46px;
        height: 46px;
        line-height: 46px;
        border: 1px solid rgba(0,0,0,0.12);
      }
      .contact-page select:hover {
        border-color: rgba(0,0,0,0.22);
      }
      /* Modern scrollbars (scoped) */
      .contact-page ::-webkit-scrollbar { width: 10px; height: 10px; }
      .contact-page ::-webkit-scrollbar-track { background: rgba(0,0,0,0.05); border-radius: 10px; }
      .contact-page ::-webkit-scrollbar-thumb {
        background: linear-gradient(180deg, rgba(184,58,58,0.7), rgba(184,58,58,0.5));
        border-radius: 10px;
        border: 2px solid rgba(255,255,255,0.6);
      }
      .contact-page ::-webkit-scrollbar-thumb:hover { background: linear-gradient(180deg, rgba(184,58,58,0.85), rgba(184,58,58,0.65)); }
      .contact-page * { scrollbar-color: rgba(184,58,58,0.6) rgba(0,0,0,0.06); scrollbar-width: thin; }
      .contact-page input:focus,
      .contact-page select:focus,
      .contact-page textarea:focus {
        outline: none;
        border-color: #b83a3a;
        box-shadow: 0 0 0 3px rgba(184,58,58,0.12);
        background-color: #fff;
      }
      .contact-page .btn.primary {
        background: #b83a3a;
        border: none;
        border-radius: 12px;
        color: #fff;
        transition: transform .15s ease, box-shadow .2s ease, background-color .2s ease;
      }
      .contact-page .btn.primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(184,58,58,0.28);
        background: #a83535;
      }
      .contact-page .trust-note {
        margin-top: 10px;
        font-size: .85rem;
        color: rgba(0,0,0,0.55);
      }
      /* Slightly darker placeholders for readability */
      .contact-page input::placeholder,
      .contact-page textarea::placeholder {
        color: rgba(0,0,0,0.50);
      }
      /* Success message styling */
      .contact-page .success-msg {
        margin-top: 14px;
        padding: 12px 14px;
        border-radius: 10px;
        background: rgba(46, 125, 50, 0.08);
        color: #2e7d32;
        border: 1px solid rgba(46,125,50,0.22);
        font-size: 0.95rem;
        display: none;
      }
      .contact-page .micro-quote {
        margin: 18px auto 24px;
        font-family: 'Cormorant Garamond', serif;
        font-style: italic;
        color: rgba(0,0,0,0.7);
        text-align: center;
        font-size: 1.25rem;
      }
      /* Honeypot alanını tamamen gizle */
      .hp-wrapper {
        position: absolute !important;
        left: -9999px !important;
        width: 1px !important;
        height: 1px !important;
        overflow: hidden !important;
      }
    </style>
</head>

<body class="contact-page">
    <header class="header">
        <div class="header-container">
            <a href="index.html" class="logo">
                <span class="logo-text">KADİR VERAL</span>
                <span class="logo-line"></span>
            </a>

            <nav class="nav">
                <ul class="nav-list">
                    <li><a href="index.html" class="nav-link">ANA SAYFA</a></li>
                    <li><a href="books.html" class="nav-link">KİTAPLAR</a></li>
                    <li><a href="gundem-arsivi.html" class="nav-link">KÖŞE YAZILARIM</a></li>
                    <li><a href="haberler.html" class="nav-link">HABERLER</a></li>
                    <li><a href="form.html" class="nav-link active">İLETİŞİM</a></li>
                </ul>
            </nav>

            <div class="social-links">
                <a href="#" class="social-link"><i class="fab fa-facebook-f"></i></a>
                <a href="#" class="social-link"><i class="fab fa-instagram"></i></a>
                <a href="#" class="social-link"><i class="fab fa-x-twitter"></i></a>
                <a href="form.html" class="social-link"><i class="far fa-envelope"></i></a>
            </div>

            <button class="mobile-toggle" aria-label="Menü">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </header>

    <main class="page">
        <section class="form-section container">
            <p class="micro-quote">“Ben aşk nedir bilmem. Eski kafalıyım. Bir seni bilirim.Bir de adın geçince sıkışan kalbimi”</p>
            <div class="form-intro">
                <h1 class="detail-title">İletişim ve Genel Başvuru Formu</h1>
                <p class="detail-desc">Görüş, öneri, röportaj talebi, etkinlik daveti veya iş birliği tekliflerinizi bu form aracılığıyla iletebilirsiniz. Mesajınız en kısa sürede değerlendirilerek tarafınıza dönüş sağlanacaktır.</p>
            </div>

            <div class="form-grid">
                <form class="form-card" action="/api/form" method="post" novalidate>
                    <!-- Botlara karşı honeypot ve zaman damgası -->
                    <div class="hp-wrapper" aria-hidden="true">
                      <label for="website">Website</label>
                      <input type="text" id="website" name="website" autocomplete="off" tabindex="-1">
                    </div>
                    <input type="hidden" name="form_ts" id="form_ts">
                    <div class="form-row">
                        <div class="form-field">
                            <label for="name">Ad Soyad</label>
                            <input type="text" id="name" name="name" placeholder="Adınızı ve soyadınızı giriniz" required>
                        </div>
                        <div class="form-field">
                            <label for="email">E-posta</label>
                            <input type="email" id="email" name="email" placeholder="ornek@mail.com" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-field">
                            <label for="topic">Konu</label>
                            <select id="topic" name="topic" class="hidden-select" required>
                                <option value="" selected disabled>Seçiniz</option>
                                <option>Okur Geri Bildirimi</option>
                                <option>Röportaj / Basın Talebi</option>
                                <option>Etkinlik & Söyleşi Daveti</option>
                                <option>İş Birliği Önerisi</option>
                                <option>Diğer</option>
                            </select>
                            <div id="topic-custom" class="custom-select" aria-haspopup="listbox" aria-expanded="false" role="combobox"></div>
                        </div>
                        <div class="form-field">
                            <label for="phone">Telefon (opsiyonel)</label>
                            <input type="tel" id="phone" name="phone" placeholder="05xx xxx xx xx"
                                inputmode="tel" autocomplete="tel" pattern="^[0-9()+ \-]{10,}$">
                        </div>
                    </div>

                    <div class="form-field">
                        <label for="message">Mesajınız</label>
                        <textarea id="message" name="message" rows="6" placeholder="İletmek istediğiniz mesajı kısaca yazınız…"
                            required></textarea>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn primary">Mesajı İlet</button>
                    </div>
                    <p class="trust-note">İletişim bilgileriniz üçüncü kişilerle paylaşılmaz.</p>
                    <div class="success-msg" role="alert" aria-live="polite">Mesajınız başarıyla iletildi. İlginiz için teşekkür ederim.</div>
                </form>
            </div>
        </section>
    </main>

    <script>
        const mobileToggle = document.querySelector('.mobile-toggle');
        const nav = document.querySelector('.nav');
        mobileToggle.addEventListener('click', () => {
            mobileToggle.classList.toggle('active');
            nav.classList.toggle('active');
        });

        window.addEventListener('scroll', () => {
            const header = document.querySelector('.header');
            if (window.scrollY > 50) header.classList.add('scrolled');
            else header.classList.remove('scrolled');
        });

        // Submit to API and show proper success/error feedback
        const formEl = document.querySelector('.form-card');
        const successBox = document.querySelector('.success-msg');
        if (formEl && successBox) {
          // Form yüklendiğinde zaman damgasını ayarla
          const tsInput = formEl.querySelector('input[name="form_ts"]');
          if (tsInput) {
            tsInput.value = String(Date.now());
          }

          formEl.addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = formEl.querySelector('button[type="submit"]');
            const hp = formEl.querySelector('input[name="website"]')?.value || '';
            const formTs = formEl.querySelector('input[name="form_ts"]')?.value || '';
            const data = {
              name: formEl.name.value.trim(),
              email: formEl.email.value.trim(),
              topic: formEl.topic.value || document.querySelector('#topic-custom [aria-selected="true"]')?.dataset.value || '',
              phone: formEl.phone.value.trim(),
              message: formEl.message.value.trim(),
              website: hp,
              form_ts: formTs
            };

            // basic guard
            if (!data.name || !data.email || !data.message || !data.topic) {
              alert('Lütfen gerekli alanları doldurunuz.');
              return;
            }

            try {
              btn && (btn.disabled = true, btn.textContent = 'Gönderiliyor...');
              const res = await fetch('/api/contact', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
              });
              const payload = await res.json().catch(() => ({}));
              if (res.ok && payload.ok) {
                successBox.style.display = 'block';
                formEl.reset();
                successBox.scrollIntoView({ behavior: 'smooth', block: 'center' });
              } else {
                const msg = payload.error || 'Mesaj gönderilemedi. Lütfen daha sonra tekrar deneyin.';
                alert(msg);
              }
            } catch (err) {
              alert('Bağlantı hatası. Lütfen daha sonra tekrar deneyin.');
            } finally {
              if (btn) { btn.disabled = false; btn.textContent = 'Mesajı İlet'; }
            }
          });
        }

        // Custom dropdown for Topic
        (function initCustomTopicSelect(){
          const hidden = document.getElementById('topic');
          const mount = document.getElementById('topic-custom');
          if (!hidden || !mount) return;

          // Build toggle
          const toggle = document.createElement('button');
          toggle.type = 'button';
          toggle.className = 'custom-select-toggle';
          const textSpan = document.createElement('span');
          textSpan.textContent = hidden.options[0]?.textContent || 'Seçiniz';
          toggle.appendChild(textSpan);

          // Build menu
          const menu = document.createElement('div');
          menu.className = 'custom-select-menu';
          menu.setAttribute('role','listbox');

          Array.from(hidden.options).forEach((opt, idx) => {
            if (opt.disabled) return; // skip placeholder
            const item = document.createElement('div');
            item.className = 'custom-select-option';
            item.setAttribute('role','option');
            item.textContent = opt.textContent;
            item.dataset.value = opt.value || opt.textContent;
            item.addEventListener('click', () => {
              // mark selection
              Array.from(menu.children).forEach(el => el.setAttribute('aria-selected','false'));
              item.setAttribute('aria-selected','true');
              // sync hidden
              hidden.value = item.dataset.value;
              textSpan.textContent = item.textContent;
              mount.classList.remove('open');
              mount.setAttribute('aria-expanded','false');
              toggle.focus();
            });
            // preselect if hidden already has value
            if (hidden.value && (hidden.value === (opt.value || opt.textContent))) {
              item.setAttribute('aria-selected','true');
              textSpan.textContent = opt.textContent;
            }
            if (idx === 0 && !hidden.value) {
              item.setAttribute('aria-selected','false');
            }
            if (!opt.disabled) menu.appendChild(item);
          });

          // Mount
          mount.appendChild(toggle);
          mount.appendChild(menu);

          // Open/close handlers
          const open = () => { mount.classList.add('open'); mount.setAttribute('aria-expanded','true'); };
          const close = () => { mount.classList.remove('open'); mount.setAttribute('aria-expanded','false'); };
          toggle.addEventListener('click', (e) => {
            e.stopPropagation();
            if (mount.classList.contains('open')) close(); else open();
          });
          document.addEventListener('click', (e) => {
            if (!mount.contains(e.target)) close();
          });

          // Keyboard support
          toggle.addEventListener('keydown', (e) => {
            const options = Array.from(menu.querySelectorAll('.custom-select-option'));
            const current = options.findIndex(o => o.getAttribute('aria-selected') === 'true');
            if (e.key === 'ArrowDown') { e.preventDefault(); open(); (options[current+1]||options[0]).focus?.(); }
            else if (e.key === 'ArrowUp') { e.preventDefault(); open(); (options[current-1]||options[options.length-1]).focus?.(); }
            else if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); open(); }
            else if (e.key === 'Escape') { close(); }
          });
          menu.addEventListener('keydown', (e) => {
            const options = Array.from(menu.querySelectorAll('.custom-select-option'));
            let idx = options.findIndex(o => o === document.activeElement);
            if (e.key === 'ArrowDown') { e.preventDefault(); (options[idx+1]||options[0]).focus(); }
            else if (e.key === 'ArrowUp') { e.preventDefault(); (options[idx-1]||options[options.length-1]).focus(); }
            else if (e.key === 'Enter') { e.preventDefault(); document.activeElement?.click(); }
            else if (e.key === 'Escape') { e.preventDefault(); close(); toggle.focus(); }
          });

          // Reset text when form resets
          formEl?.addEventListener('reset', () => {
            textSpan.textContent = hidden.options[0]?.textContent || 'Seçiniz';
            Array.from(menu.children).forEach(el => el.setAttribute('aria-selected','false'));
            close();
          });
        })();
    </script>
</body>

</html>